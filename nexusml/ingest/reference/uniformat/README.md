# Uniformat Reference Data

This directory contains reference data for the Uniformat classification system.

## Files

- `uniformat_classifications.csv`: Main Uniformat classification data with
  codes, titles, and descriptions
- `uniformat-keywords.csv`: Mapping of keywords to Uniformat codes and
  MasterFormat numbers
- `index_parse.py`: Script to parse Uniformat index from markdown files
- `create_uniformat_csv.py`: Script to create the Uniformat classifications CSV
  file

## Uniformat Keywords

The `uniformat-keywords.csv` file provides a mapping between common keywords and
their corresponding Uniformat codes and MasterFormat numbers. This is useful
for:

1. Finding Uniformat codes by keyword search
2. Automatically classifying equipment based on their names or descriptions
3. Cross-referencing between Uniformat and MasterFormat classification systems

### File Format

The `uniformat-keywords.csv` file has the following columns:

- `Keyword`: Common term or phrase related to building elements
- `UF Number`: Corresponding Uniformat code (e.g., D3020.10)
- `MF Number`: Corresponding MasterFormat number (e.g., 23 52 00)

### Usage

The Uniformat keywords data is automatically loaded by the `UniformatDataSource`
class and can be accessed through the `ReferenceManager`:

```python
from nexusml.core.reference.manager import ReferenceManager

# Initialize the reference manager
ref_manager = ReferenceManager()

# Load all reference data
ref_manager.load_all()

# Find Uniformat codes by keyword
results = ref_manager.find_uniformat_codes_by_keyword("Boilers")
for result in results:
    print(f"Keyword: {result['keyword']}")
    print(f"Uniformat Code: {result['uniformat_code']}")
    print(f"MasterFormat Code: {result['masterformat_code']}")
```

### Enriching Equipment Data

The `ReferenceManager.enrich_equipment_data()` method now uses the keywords data
to automatically find Uniformat and MasterFormat codes for equipment when they
are missing:

```python
import pandas as pd
from nexusml.core.reference.manager import ReferenceManager

# Create a DataFrame with equipment data
equipment_data = [
    {"equipment_id": "EQ001", "equipment_name": "Air Handling Unit", "uniformat_code": None},
    {"equipment_id": "EQ002", "equipment_name": "Boiler", "uniformat_code": None},
]
df = pd.DataFrame(equipment_data)

# Initialize the reference manager
ref_manager = ReferenceManager()
ref_manager.load_all()

# Enrich the DataFrame with reference information
enriched_df = ref_manager.enrich_equipment_data(df)
```

### Example

See `nexusml/examples/uniformat_keywords_example.py` for a complete example of
how to use the Uniformat keywords functionality.

## Updating the Keywords Data

The `uniformat-keywords.csv` file is generated by the `index_parse.py` script,
which parses a markdown file containing the Uniformat index. To update the
keywords data:

1. Place the markdown file in the `index` subdirectory
2. Run the `index_parse.py` script:

```bash
python -m nexusml.ingest.reference.uniformat.index_parse
```

This will generate a new `uniformat-keywords.csv` file.
