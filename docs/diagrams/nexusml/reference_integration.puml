@startuml "NexusML Reference Data Integration"

' Style definitions
skinparam backgroundColor white
skinparam ArrowColor #666666
skinparam ComponentBorderColor #999999
skinparam ComponentBackgroundColor #EEEEEE
skinparam NoteBorderColor #999999
skinparam NoteBackgroundColor #EEEEEE

' Title
title NexusML Reference Data Integration

' Components
package "Reference Data Sources" {
  [OmniClass] as OmniClass
  [Uniformat] as Uniformat
  [MasterFormat] as MasterFormat
  [MCAA Glossary] as MCAA
  [SMACNA] as SMACNA
  [ASHRAE] as ASHRAE
  [Equipment Taxonomy] as Taxonomy
}

package "Configuration Files" {
  [reference_config.yml] as RefConfig
  [equipment_attributes.json] as EAVConfig
  [masterformat_primary.json] as MFPrimary
  [masterformat_equipment.json] as MFEquipment
}

package "Core Components" {
  [ReferenceManager] as RefManager
  [EAVManager] as EAVManager
  [KeywordClassificationMapper] as KeywordMapper
  [ClassificationSystemMapper] as ClassMapper
  [enhanced_masterformat_mapping()] as EnhancedMapping
}

package "Data Flow" {
  [Data Preprocessing] as Preprocessing
  [Data Mapping] as Mapping
  [Feature Engineering] as FeatureEng
  [Model Training] as Training
  [Prediction] as Prediction
}

' Relationships - Reference Sources to Manager
OmniClass --> RefManager
Uniformat --> RefManager
MasterFormat --> RefManager
MCAA --> RefManager
SMACNA --> RefManager
ASHRAE --> RefManager
Taxonomy --> RefManager

' Relationships - Configuration to Managers
RefConfig --> RefManager : configures
EAVConfig --> EAVManager : configures
MFPrimary --> EnhancedMapping : used by
MFEquipment --> EnhancedMapping : used by

' Relationships - Managers to Components
RefManager --> KeywordMapper : provides reference data
RefManager --> ClassMapper : provides reference data
EAVManager --> FeatureEng : provides attribute templates
EAVManager --> Prediction : provides attribute templates
EnhancedMapping --> ClassMapper : used by

' Relationships - Data Flow
Preprocessing --> Mapping
Mapping --> FeatureEng
FeatureEng --> Training
FeatureEng --> Prediction

' Reference Integration Points
RefManager --> Preprocessing : validation rules
RefManager --> FeatureEng : classification mappings
EAVManager --> FeatureEng : attribute integration
RefManager --> Prediction : validation & enhancement
EAVManager --> Prediction : attribute templates

' Notes
note bottom of RefManager
  Loads and manages all reference data sources
  based on reference_config.yml
end note

note bottom of EAVManager
  Manages equipment attribute templates
  based on equipment_attributes.json
end note

note bottom of KeywordMapper
  Maps equipment descriptions to
  classification system IDs using keywords
end note

note bottom of ClassMapper
  Maps between different classification systems
  (e.g., Uniformat to MasterFormat)
end note

@enduml