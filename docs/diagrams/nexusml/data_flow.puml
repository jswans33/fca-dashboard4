@startuml "NexusML Data Flow"

' Style definitions
skinparam backgroundColor white
skinparam ArrowColor #666666
skinparam ActivityBorderColor #999999
skinparam ActivityBackgroundColor #EEEEEE
skinparam ActivityDiamondBorderColor #999999
skinparam ActivityDiamondBackgroundColor #EEEEEE

' Title
title NexusML Data Flow

' Start
start

' Data Ingestion
:Input Data;
note right
  CSV, Excel, or other formats
  with arbitrary column structure
end note

' Data Preprocessing
:load_and_preprocess_data();
note right
  - Load data from file
  - Clean column names
  - Fill NaN values
  - Verify required columns
end note

' Data Mapping
:map_staging_to_model_input();
note right
  - Map columns to expected format
  - Fill required fields with defaults
  - Convert numeric fields
end note

' Feature Engineering
:GenericFeatureEngineer.transform();
note right
  - Apply column mappings
  - Combine text fields
  - Clean numeric columns
  - Create hierarchical categories
  - Apply classification mappings
  - Add EAV attributes
end note

' Split Data
:train_test_split();
note right
  - Split into training and test sets
  - X contains text and numeric features
  - y contains multiple target columns
end note

' Model Building
:build_enhanced_model();
note right
  - Create TF-IDF vectorizer for text
  - Create StandardScaler for numeric features
  - Combine with ColumnTransformer
  - Create MultiOutputClassifier with RandomForest
end note

' Model Training
:model.fit(X_train, y_train);
note right
  - Train the model on multiple targets
  - Use class_weight for imbalanced classes
end note

' Model Evaluation
:enhanced_evaluation();
note right
  - Evaluate on test set
  - Generate classification reports
  - Analyze "Other" category performance
end note

' Feature Analysis
:analyze_other_category_features();
note right
  - Analyze important features for "Other" category
  - Extract feature importances from RandomForest
end note

' Misclassification Analysis
:analyze_other_misclassifications();
note right
  - Analyze false positives and negatives
  - Show examples of misclassifications
end note

' Save Model
:Save model and metadata;
note right
  - Save model to pickle file
  - Save metadata with metrics
  - Create symlinks to latest model
end note

' End
stop

@enduml